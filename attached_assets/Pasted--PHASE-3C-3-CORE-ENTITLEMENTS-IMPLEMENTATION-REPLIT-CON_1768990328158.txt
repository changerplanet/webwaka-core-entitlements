
ğŸš€ PHASE 3C-3 â€” CORE ENTITLEMENTS IMPLEMENTATION (REPLIT)

CONTEXT (READ CAREFULLY)

You are implementing Phase 3C-3: webwaka-core-entitlements for the WebWaka platform.

This is a CORE, HEADLESS, PURE LOGIC MODULE.

The Phase 3C-2 Specification is LOCKED and must be followed exactly.

ğŸš« DO NOT add UI
ğŸš« DO NOT add storage adapters
ğŸš« DO NOT add APIs, servers, or frameworks
ğŸš« DO NOT introduce pricing, billing, subscriptions, or payments
ğŸš« DO NOT introduce permissions or feature flags
ğŸš« DO NOT deviate from the precedence rules

This task is pure TypeScript library implementation only.

â¸»

ğŸ”’ SOURCE OF TRUTH (IMMUTABLE)
	â€¢	WebWaka Ecosystem Constitution v1.5+
	â€¢	Phase 3C-2 â€” Core Entitlements Specification (LOCKED)

If anything conflicts:
â¡ The specification overrides assumptions.

â¸»

ğŸ“¦ TARGET REPOSITORY (MANDATORY)

Repository:
changerplanet/webwaka-core-entitlements

CRITICAL RULE (DO NOT VIOLATE)
	â€¢	The repository already exists
	â€¢	You MUST CLONE IT FIRST
	â€¢	If cloning fails or the repo is not found â†’ STOP and report
	â€¢	If the repo is empty â†’ leave it empty (do NOT scaffold or add placeholders unless instructed)

ğŸš« Replit must NOT auto-create scaffolding
ğŸš« Replit must NOT add â€œminimal runnable placeholdersâ€

If Replit auto-adds anything:
â¡ DELETE IT IMMEDIATELY AFTER CLONING

â¸»

ğŸ¯ IMPLEMENTATION OBJECTIVE

Implement a pure, deterministic Core Entitlements engine that:
	â€¢	Evaluates entitlement grants and overrides
	â€¢	Enforces strict precedence hierarchy
	â€¢	Supports offline-safe snapshots
	â€¢	Is explainable, deterministic, and tenant-isolated

â¸»

ğŸ§  FUNCTIONAL REQUIREMENTS (MANDATORY)

1ï¸âƒ£ Domain Models (Zod-Validated)

Implement immutable models:
	â€¢	EntitlementDefinition
	â€¢	EntitlementGrant
	â€¢	EntitlementOverride
	â€¢	EntitlementContext
	â€¢	EntitlementResult
	â€¢	EntitlementSnapshot

All models:
	â€¢	Must be Zod-validated
	â€¢	Must be deeply immutable
	â€¢	Must be JSON-serializable

â¸»

2ï¸âƒ£ Precedence Hierarchy (LOCKED)

Evaluation MUST follow exactly this order:
	1.	Individual Overrides
	2.	Group Overrides
	3.	Tenant Grants
	4.	Plan Grants
	5.	Partner Grants
	6.	System Defaults
	7.	Definition Default

â¡ First valid (non-expired) rule wins.

No exceptions.

â¸»

3ï¸âƒ£ Core APIs (EXACT)

Implement all of the following:

evaluateEntitlement(
  entitlementId,
  context,
  grants,
  overrides
): EntitlementResult

generateSnapshot(
  context,
  grants,
  overrides
): EntitlementSnapshot

verifySnapshot(snapshot): boolean

evaluateFromSnapshot(
  entitlementId,
  snapshot,
  currentTime
): EntitlementResult


â¸»

4ï¸âƒ£ Determinism & Time
	â€¢	evaluationTime must be explicitly provided
	â€¢	âŒ No Date.now()
	â€¢	âŒ No randomness
	â€¢	Same input â†’ same output (provable)

â¸»

5ï¸âƒ£ Tenant Isolation (CRITICAL)
	â€¢	Every evaluation must require tenantId
	â€¢	Cross-tenant data access must throw
	â€¢	Snapshot verification must reject tenant mismatch

â¸»

6ï¸âƒ£ Snapshot Integrity
	â€¢	Canonical JSON serialization
	â€¢	SHA-256 checksum
	â€¢	Tamper detection
	â€¢	Expiry enforcement

Snapshots must be:
	â€¢	Offline evaluable
	â€¢	Deterministic
	â€¢	Verifiable

â¸»

ğŸ§ª TEST REQUIREMENTS (NON-NEGOTIABLE)

You MUST implement tests proving:

âœ… Override beats plan
âœ… Expired grants are ignored
âœ… Snapshot evaluation === live evaluation
âœ… Determinism (10Ã— repeated evaluation)
âœ… Cross-tenant access is rejected
âœ… Snapshot tampering is detected

Coverage:
	â€¢	â‰¥ 80% statements
	â€¢	Focus on logic, not mocks

â¸»

ğŸ“„ MODULE MANIFEST (MANDATORY)

Update module.manifest.json with capabilities:

[
  "entitlement:check",
  "entitlement:snapshot.generate",
  "entitlement:snapshot.verify",
  "entitlement:grant.define",
  "entitlement:override.apply"
]


â¸»

âŒ EXPLICIT EXCLUSIONS

You must NOT implement:
	â€¢	âŒ Storage or databases
	â€¢	âŒ Pricing logic
	â€¢	âŒ Feature flags
	â€¢	âŒ Permissions
	â€¢	âŒ UI or dashboards
	â€¢	âŒ Cron jobs
	â€¢	âŒ Background workers

â¸»

ğŸ§¾ FINAL DELIVERABLE

When done, provide a Completion Report including:
	1.	APIs implemented
	2.	Precedence enforcement proof
	3.	Snapshot guarantees
	4.	Test count + coverage
	5.	Hard-stop proof explanation
	6.	Final commit SHA

â¸»

â›” HARD STOP

After completing this task:

â›” STOP
â›” Do NOT proceed to any other phase
â›” Await explicit authorization

â¸»

âœ… ACKNOWLEDGEMENT FORMAT

Reply only with:

â€œPhase 3C-3 acknowledged. Implementing Core Entitlements exactly as specified.â€

Then execute.

â¸»